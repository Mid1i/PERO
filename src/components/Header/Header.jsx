import {useNavigate, useLocation} from "react-router-dom";
import {useContext, useState} from "react";
import classNames from "classnames";

import {imageImport, isPWA, toFormatBrandForRequest} from "@utils/helpers";
import {brands} from "@utils/constants";
import {appContext} from "@services";
import {useNoScroll} from "@hooks";

import mainLogo  from "@assets/images/logo/shop-logo.svg";

import "./Header.style.scss";


export default function Header() {
    const {isMale, isRegisteredUser, setIsMale, setAuthPopup} = useContext(appContext);
    const [popupMenu, changePopupMenu] = useState(false);

    const images = imageImport();
    const navigate = useNavigate();
    const {pathname} = useLocation();
    
    useNoScroll(popupMenu);


    const onClickProfile = () => {
        if (isRegisteredUser) {
            navigate('/customer/account');
        } else {
            setAuthPopup();
        }
    }

    const onClickGender = (gender) => {
        setIsMale(gender);
  
        if (pathname !== '/catalog/') {
            navigate('/catalog/');
        }
    }

    const onClickBrand = (value) => {
        navigate(`/catalog/?brands=${toFormatBrandForRequest(value)}`);
        changePopupMenu(false);
    }

    
    const popupMenuRender = () => {
        return (
            <div className={classNames("header__blackout blackout", popupMenu && "active")}>
                <div className={classNames("header__blackout-mobile header-mobile", popupMenu && "active")}>
                    {isPWA() ? (
                        <>
                            <h4 className="header-mobile__title">Бренды</h4>
                            <ul className="header-mobile__list header-mobile__list--brands">
                                {brands.map(({id, brand}) => (
                                    <li className="header-nav__el--brands" onClick={() => onClickBrand(brand)} key={id}>
                                        <img src={images.filter(obj => obj.includes(brand))} alt={brand}/>
                                    </li>
                                ))}
                            </ul>
                        </>
                    ) : (
                        <ul className="header-mobile__list header-mobile__list--app">
                            {menuItemsRender()}
                            <li className="header-nav__el" onClick={() => navigate('/about')}>
                                <svg className="header-nav__el-icon" height="20" viewBox="0 0 20 20" width="20">
                                    <path d="M10.625 13.75V8.75H8.125V10H9.375V13.75H7.5V15H12.5V13.75H10.625Z" fill="black"/>
                                    <path d="M10 5C9.81458 5 9.63332 5.05498 9.47915 5.158C9.32498 5.26101 9.20482 5.40743 9.13386 5.57873C9.06291 5.75004 9.04434 5.93854 9.08051 6.1204C9.11669 6.30225 9.20598 6.4693 9.33709 6.60041C9.4682 6.73152 9.63525 6.82081 9.8171 6.85699C9.99896 6.89316 10.1875 6.87459 10.3588 6.80364C10.5301 6.73268 10.6765 6.61252 10.7795 6.45835C10.8825 6.30418 10.9375 6.12292 10.9375 5.9375C10.9375 5.68886 10.8387 5.4504 10.6629 5.27459C10.4871 5.09877 10.2486 5 10 5Z" fill="black"/>
                                    <path d="M10 18.75C8.26942 18.75 6.57769 18.2368 5.13876 17.2754C3.69983 16.3139 2.57832 14.9473 1.91606 13.3485C1.25379 11.7496 1.08051 9.9903 1.41813 8.29296C1.75575 6.59563 2.58911 5.03653 3.81282 3.81282C5.03653 2.58911 6.59563 1.75575 8.29296 1.41813C9.9903 1.08051 11.7496 1.25379 13.3485 1.91606C14.9473 2.57832 16.3139 3.69983 17.2754 5.13876C18.2368 6.57769 18.75 8.26942 18.75 10C18.75 12.3206 17.8281 14.5462 16.1872 16.1872C14.5462 17.8281 12.3206 18.75 10 18.75ZM10 2.5C8.51664 2.5 7.0666 2.93987 5.83323 3.76398C4.59986 4.58809 3.63856 5.75943 3.07091 7.12988C2.50325 8.50032 2.35473 10.0083 2.64411 11.4632C2.9335 12.918 3.64781 14.2544 4.6967 15.3033C5.7456 16.3522 7.08197 17.0665 8.53683 17.3559C9.99168 17.6453 11.4997 17.4968 12.8701 16.9291C14.2406 16.3614 15.4119 15.4001 16.236 14.1668C17.0601 12.9334 17.5 11.4834 17.5 10C17.5 8.01088 16.7098 6.10323 15.3033 4.6967C13.8968 3.29018 11.9891 2.5 10 2.5Z" fill="black"/>
                                </svg>
                                <span className="header-nav__el-text">О магазине</span>
                            </li>
                            <li className="header-nav__el" onClick={() => navigate('/about')}>
                                <svg className="header-nav__el-icon" fill="none" height="21" viewBox="0 0 20 21" width="20">
                                    <path d="M10 19.632C14.9706 19.632 19 15.6025 19 10.632C19 5.6614 14.9706 1.63196 10 1.63196C5.02944 1.63196 1 5.6614 1 10.632C1 15.6025 5.02944 19.632 10 19.632Z" stroke="black" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                    <path d="M7.3811 7.93196C7.5927 7.33046 8.01034 6.82325 8.56006 6.50018C9.10978 6.1771 9.75611 6.059 10.3846 6.1668C11.013 6.2746 11.583 6.60133 11.9937 7.08913C12.4043 7.57694 12.6291 8.19433 12.6281 8.83196C12.6281 10.632 9.9281 11.532 9.9281 11.532" stroke="black" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                    <path d="M10 15.132H10.009" stroke="black" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                                </svg>
                                <span className="header-nav__el-text">Помощь</span>
                            </li>
                            <li className="header-nav__el" onClick={() => navigate('/brands')}>
                                <svg className="header-nav__el-icon" height="19" viewBox="0 0 15 19" width="15">
                                    <path fillRule="evenodd" clipRule="evenodd" d="M10.4494 18.632H4.54219C2.30836 18.6271 0.5 16.7499 0.5 14.4357V4.81943C0.504641 2.50871 2.31165 0.636766 4.54219 0.631958H10.4494C12.6832 0.631958 14.4954 2.50531 14.5 4.81943V14.4357C14.5 15.5486 14.0732 16.6159 13.3136 17.4029C12.5539 18.1899 11.5236 18.632 10.4494 18.632ZM4.54219 2.02195C3.05274 2.02676 1.84641 3.27645 1.84177 4.81943V14.4357C1.84177 15.9821 3.04945 17.2372 4.54219 17.242H10.4494C11.9454 17.242 13.1582 15.9855 13.1582 14.4357V4.81943C13.1536 3.27304 11.9421 2.02195 10.4494 2.02195H4.54219ZM3.86709 7.21477H9.5211C9.83578 7.17665 10.0731 6.90049 10.0731 6.57222C10.0731 6.24395 9.83578 5.96779 9.5211 5.92967H3.86709C3.62819 5.90074 3.39451 6.01648 3.26633 6.22726C3.13806 6.43803 3.13806 6.70641 3.26633 6.91718C3.39451 7.12796 3.62819 7.2437 3.86709 7.21477ZM3.86709 14.2085H7.90084C8.13975 14.2374 8.37342 14.1216 8.5016 13.9109C8.62987 13.7001 8.62987 13.4317 8.5016 13.2209C8.37342 13.0102 8.13975 12.8944 7.90084 12.9234H3.86709C3.62819 12.8944 3.39451 13.0102 3.26633 13.2209C3.13806 13.4317 3.13806 13.7001 3.26633 13.9109C3.39451 14.1216 3.62819 14.2374 3.86709 14.2085ZM11.1329 10.7116H3.86709C3.62819 10.7405 3.39451 10.6248 3.26633 10.414C3.13806 10.2033 3.13806 9.93487 3.26633 9.7241C3.39451 9.51333 3.62819 9.39758 3.86709 9.42652H11.1329C11.4476 9.46464 11.6849 9.7408 11.6849 10.0691C11.6849 10.3973 11.4476 10.6735 11.1329 10.7116Z" fill="black"/>
                                </svg>
                                <span className="header-nav__el-text">Бренды</span>
                            </li>
                        </ul>
                    )}
                    <img className="header-mobile__logo" src={mainLogo} alt="logo" onClick={() => navigate('/')}/>
                </div>
            </div>
        );
    }

    const menuItemsRender = () => {
        return (
            <>
                <li className="header-nav__el" onClick={() => navigate('/catalog')}>
                    <svg className="header-nav__el-icon" height="18" viewBox="0 0 18 18" width="18">
                        <path clipRule="evenodd" fillRule="evenodd" d="M2.25002 0H5.34002C5.93852 0 6.51232 0.2384 6.93462 0.6625C7.35682 1.0867 7.59272 1.6615 7.59002 2.26V5.34C7.59002 6.5826 6.58272 7.59 5.34002 7.59H2.25002C1.00742 7.59 2.12752e-05 6.5826 2.12752e-05 5.34V2.26C-0.00257872 1.6615 0.233222 1.0867 0.655522 0.6625C1.07772 0.2384 1.65152 0 2.25002 0ZM5.34002 6.08C5.75202 6.0746 6.08462 5.742 6.09002 5.33V2.26C6.09002 1.8458 5.75422 1.51 5.34002 1.51H2.25002C1.83582 1.51 1.50002 1.8458 1.50002 2.26V5.33C1.50542 5.742 1.83812 6.0746 2.25002 6.08H5.34002Z" fill="#000000"/>
                        <path clipRule="evenodd" fillRule="evenodd" d="M12.6602 0H15.7502C16.3486 0 16.9224 0.2384 17.3447 0.6625C17.7669 1.0867 18.0028 1.6615 18.0002 2.26V5.34C18.0002 6.5826 16.9928 7.59 15.7502 7.59H12.6602C11.4175 7.59 10.4102 6.5826 10.4102 5.34V2.25C10.4102 1.0074 11.4175 0 12.6602 0ZM15.7502 6.08C16.1621 6.0746 16.4948 5.742 16.5002 5.33V2.26C16.5002 1.8458 16.1644 1.51 15.7502 1.51H12.6602C12.2459 1.51 11.9102 1.8458 11.9102 2.26V5.33C11.9155 5.742 12.2482 6.0746 12.6602 6.08H15.7502Z" fill="#000000"/>
                        <path clipRule="evenodd" fillRule="evenodd" d="M2.25002 10.4099H5.34002C6.58272 10.4099 7.59002 11.4173 7.59002 12.6599V15.7499C7.59002 16.9926 6.58272 17.9999 5.34002 17.9999H2.25002C1.65152 17.9999 1.07772 17.7615 0.655522 17.3374C0.233222 16.9132 -0.00257872 16.3384 2.12752e-05 15.7399V12.6599C2.12752e-05 11.4173 1.00742 10.4099 2.25002 10.4099ZM5.34002 16.4899C5.75422 16.4899 6.09002 16.1541 6.09002 15.7399V12.6599C6.08462 12.248 5.75202 11.9153 5.34002 11.9099H2.25002C1.83812 11.9153 1.50542 12.248 1.50002 12.6599V15.7399C1.50002 16.1541 1.83582 16.4899 2.25002 16.4899H5.34002Z" fill="#000000"/>
                        <path clipRule="evenodd" fillRule="evenodd" d="M12.6602 10.4099H15.7502C16.9928 10.4099 18.0002 11.4173 18.0002 12.6599V15.7399C18.0028 16.3384 17.767 16.9132 17.3447 17.3374C16.9225 17.7615 16.3487 17.9999 15.7502 17.9999H12.6602C12.0617 17.9999 11.4879 17.7615 11.0656 17.3374C10.6434 16.9132 10.4075 16.3384 10.4102 15.7399V12.6599C10.4102 11.4173 11.4175 10.4099 12.6602 10.4099ZM15.7502 16.4899C16.1644 16.4899 16.5002 16.1541 16.5002 15.7399V12.6599C16.4948 12.248 16.1621 11.9153 15.7502 11.9099H12.6602C12.2482 11.9153 11.9156 12.248 11.9102 12.6599V15.7399C11.9102 16.1541 12.246 16.4899 12.6602 16.4899H15.7502Z" fill="#000000"/>
                    </svg>
                    <span className="header-nav__el-text">Каталог</span>
                </li>
                <li className="header-nav__el" onClick={onClickProfile}>
                    <svg className="header-nav__el-icon" height="18" viewBox="0 0 13 18" width="13">
                        <path clipRule="evenodd" fillRule="evenodd" d="M12.7313 13.239L12.9286 14.265C13.1156 15.152 12.931 16.0842 12.4252 16.8067C11.9194 17.5293 11.1454 17.9669 10.3144 18H2.68557C1.85462 17.9669 1.08055 17.5293 0.574732 16.8067C0.0689914 16.0842 -0.115565 15.152 0.0713747 14.265L0.268673 13.239C0.495565 11.8501 1.58613 10.8294 2.87465 10.8H10.1254C11.4139 10.8294 12.5044 11.8501 12.7313 13.239ZM10.3144 16.641C10.7319 16.6357 11.1247 16.4239 11.3831 16.065V16.074C11.7002 15.6386 11.8238 15.0712 11.7202 14.526L11.5229 13.5C11.4134 12.7397 10.8279 12.1703 10.1254 12.141H2.87465C2.1721 12.1703 1.58662 12.7397 1.47712 13.5L1.27983 14.526C1.17888 15.0683 1.30227 15.6317 1.61688 16.065C1.87525 16.4239 2.26812 16.6357 2.68557 16.641H10.3144Z" fill="#000000"/>
                        <path clipRule="evenodd" fillRule="evenodd" d="M6.91098 9.00001H6.08891C4.27286 9.00001 2.80061 7.38829 2.80061 5.40001V3.02401C2.79839 2.2213 3.08874 1.45072 3.60723 0.883093C4.12571 0.315463 4.82957 -0.00241617 5.56278 1.38301e-05H7.43711C8.1704 -0.00241617 8.87418 0.315463 9.39266 0.883093C9.91114 1.45072 10.2015 2.2213 10.1993 3.02401V5.40001C10.1993 7.38829 8.72711 9.00001 6.91098 9.00001ZM5.56278 1.35001C4.71834 1.35001 4.03372 2.09953 4.03372 3.02401V5.40001C4.03372 6.64264 4.95387 7.65001 6.08891 7.65001H6.91098C8.04602 7.65001 8.96617 6.64264 8.96617 5.40001V3.02401C8.96617 2.58004 8.80512 2.15425 8.5183 1.84033C8.23156 1.52641 7.84264 1.35001 7.43711 1.35001H5.56278Z" fill="#000000"/>
                    </svg>
                    <span className="header-nav__el-text">Профиль</span>
                </li>
                <li className="header-nav__el">
                    <svg className="header-nav__el-icon" height="18" viewBox="0 0 14 18" width="14">
                        <path clipRule="evenodd" fillRule="evenodd" d="M3.37571 0.00433333H10.6242C11.4759 -0.0391667 12.3105 0.246235 12.9438 0.797535C13.5771 1.34893 13.9571 2.12083 14 2.94303V16.9964C14.0012 17.2778 13.8794 17.5467 13.6645 17.737C13.4497 17.9273 13.1617 18.0213 12.8713 17.9959C12.6168 17.996 12.3694 17.9152 12.1671 17.766L7.68341 14.4776C7.26001 14.1711 6.67781 14.1711 6.25441 14.4776L1.81211 17.766C1.61561 17.9111 1.37611 17.9916 1.12871 17.9959C0.838309 18.0213 0.55031 17.9273 0.33551 17.737C0.12061 17.5467 -0.00119122 17.2778 8.78391e-06 16.9964V2.94303C0.0428088 2.12083 0.422809 1.34893 1.05621 0.797535C1.68951 0.246235 2.52411 -0.0391667 3.37571 0.00433333ZM8.64641 13.2881L12.426 16.0868L12.4053 2.94303C12.3073 2.07153 11.5087 1.43363 10.6035 1.50363H3.35501C2.44981 1.43363 1.65131 2.07153 1.55331 2.94303V16.0868L5.33281 13.2881C6.31151 12.5683 7.66781 12.5683 8.64641 13.2881Z" fill="black"/>
                    </svg>
                    <span className="header-nav__el-text">Избранное</span>
                </li>
                <li className="header-nav__el" onClick={() => navigate('/cart')}>
                    <svg className="header-nav__el-icon" height="18" viewBox="0 0 18 18" width="18">
                        <path d="M0.765144 0C0.34257 0 0 0.33579 0 0.75C0 1.16421 0.34257 1.5 0.765144 1.5H1.14114C1.48276 1.5 1.78299 1.72198 1.87684 2.04396L4.3032 10.3681C4.58475 11.334 5.48544 12 6.51031 12H13.5017C14.4403 12 15.2844 11.4399 15.633 10.5856L17.8891 5.05708C18.2911 4.07179 17.5507 3 16.4682 3H3.74703L3.34824 1.63188C3.0667 0.665955 2.166 0 1.14114 0H0.765144ZM5.77461 9.95604L4.18425 4.5H16.4682L14.2121 10.0286C14.096 10.3133 13.8145 10.5 13.5017 10.5H6.51031C6.16869 10.5 5.86846 10.278 5.77461 9.95604Z" fill="#000000"/>
                        <path d="M6.88631 18C8.15405 18 9.18175 16.9926 9.18175 15.75C9.18175 14.5074 8.15405 13.5 6.88631 13.5C5.61858 13.5 4.59088 14.5074 4.59088 15.75C4.59088 16.9926 5.61858 18 6.88631 18ZM6.88631 16.5C6.46374 16.5 6.12117 16.1642 6.12117 15.75C6.12117 15.3358 6.46374 15 6.88631 15C7.30889 15 7.65146 15.3358 7.65146 15.75C7.65146 16.1642 7.30889 16.5 6.88631 16.5Z" fill="#000000"/>
                        <path d="M13.0075 18C14.2752 18 15.3029 16.9926 15.3029 15.75C15.3029 14.5074 14.2752 13.5 13.0075 13.5C11.7397 13.5 10.712 14.5074 10.712 15.75C10.712 16.9926 11.7397 18 13.0075 18ZM13.0075 16.5C12.585 16.5 12.2423 16.1642 12.2423 15.75C12.2423 15.3358 12.585 15 13.0075 15C13.43 15 13.7726 15.3358 13.7726 15.75C13.7726 16.1642 13.43 16.5 13.0075 16.5Z" fill="#000000"/>
                    </svg>
                    <span className="header-nav__el-text">Корзина</span>
                </li>
            </>
        );
    }


    return (
        <header className="header">
            <div className="header__wrapper">
                <div className="header__wrapper-left header-left">
                    <img alt="logo" className="header-left__logo" onClick={() => navigate('/')} src={mainLogo}/>
                    <p className="header-left__gender">
                        <span className={classNames("header-left__gender-text", isMale && "active")} onClick={() => onClickGender(true)}>Мужчинам</span>
                        <span className="header-left__gender-text header-left__gender-text--middle">/</span>
                        <span className={classNames("header-left__gender-text", !isMale && "active")} onClick={() => onClickGender(false)}>Женщинам</span>
                    </p>
                </div>
                <ul className="header__wrapper-navigation header-nav">{menuItemsRender()}</ul>
                <div className="header__wrapper-icons header-icons">
                    {!isPWA() && (
                        <svg className="header-icons__cart" onClick={() => navigate('/cart')} height="18" viewBox="0 0 18 18" width="18">
                            <path d="M0.765144 0C0.34257 0 0 0.33579 0 0.75C0 1.16421 0.34257 1.5 0.765144 1.5H1.14114C1.48276 1.5 1.78299 1.72198 1.87684 2.04396L4.3032 10.3681C4.58475 11.334 5.48544 12 6.51031 12H13.5017C14.4403 12 15.2844 11.4399 15.633 10.5856L17.8891 5.05708C18.2911 4.07179 17.5507 3 16.4682 3H3.74703L3.34824 1.63188C3.0667 0.665955 2.166 0 1.14114 0H0.765144ZM5.77461 9.95604L4.18425 4.5H16.4682L14.2121 10.0286C14.096 10.3133 13.8145 10.5 13.5017 10.5H6.51031C6.16869 10.5 5.86846 10.278 5.77461 9.95604Z" fill="#000000"/>
                            <path d="M6.88631 18C8.15405 18 9.18175 16.9926 9.18175 15.75C9.18175 14.5074 8.15405 13.5 6.88631 13.5C5.61858 13.5 4.59088 14.5074 4.59088 15.75C4.59088 16.9926 5.61858 18 6.88631 18ZM6.88631 16.5C6.46374 16.5 6.12117 16.1642 6.12117 15.75C6.12117 15.3358 6.46374 15 6.88631 15C7.30889 15 7.65146 15.3358 7.65146 15.75C7.65146 16.1642 7.30889 16.5 6.88631 16.5Z" fill="#000000"/>
                            <path d="M13.0075 18C14.2752 18 15.3029 16.9926 15.3029 15.75C15.3029 14.5074 14.2752 13.5 13.0075 13.5C11.7397 13.5 10.712 14.5074 10.712 15.75C10.712 16.9926 11.7397 18 13.0075 18ZM13.0075 16.5C12.585 16.5 12.2423 16.1642 12.2423 15.75C12.2423 15.3358 12.585 15 13.0075 15C13.43 15 13.7726 15.3358 13.7726 15.75C13.7726 16.1642 13.43 16.5 13.0075 16.5Z" fill="#000000"/>
                        </svg>
                    )}
                    <div className={classNames("header-icons__burger", popupMenu && "active")} onClick={() => changePopupMenu(prev => !prev)}>
                        <span></span>
                    </div>
                </div>
            </div>
            <div className="header__gender">
                <p className={classNames("header__gender-text", isMale && "active")} onClick={() => onClickGender(true)}>Мужчинам</p>
                <p className={classNames("header__gender-text", !isMale && "active")} onClick={() => onClickGender(false)}>Женщинам</p>
            </div>
            {popupMenuRender()}
        </header>
    );
}
