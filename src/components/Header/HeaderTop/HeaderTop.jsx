import {useContext, useReducer} from "react";
import {useNavigate, useLocation} from "react-router-dom";
import classNames from "classnames";

import {imageImport, isPWA, toFormatBrandForRequest} from "@utils/helpers";
import {appContext} from "@services/Context";
import {brands} from "@utils/constants";
import {useNoScroll} from "@hooks";

import mainLogo  from "@assets/images/logo/shop-logo.svg";

import "./HeaderTop.style.scss";


export default function HeaderTop({className='header', pageToLink='/catalog/', pageToLinkName='Каталог'}) {
    const {isMale, isReg, setIsMale, changeRegPopup} = useContext(appContext);

    const [popupMenu, changePopupMenu] = useReducer(prev => !prev, false);

    const images = imageImport();

    const navigate = useNavigate();
    const {pathname} = useLocation();
    
    useNoScroll(popupMenu);


    const onClickBrand = (value) => {
        changePopupMenu();
        navigate(`/catalog/?brands=${toFormatBrandForRequest(value)}`);
    }

    const onClickRegPopup = () => {
        if (isReg) {
            navigate('/customer/account');
        } else {
            changeRegPopup();
        }
        changePopupMenu();
    }

    const onClickReg = () => {
        if (isReg) {
            navigate('/customer/account');
        } else {
            changeRegPopup();
        }
    }

    const onClickGender = (gender) => {
        setIsMale(gender);
        
        if (pathname !== '/catalog/') {
            navigate('/catalog/');
        }
    }

    
    const popupMenuRender = () => {
        return (
            <div className={classNames("blackout", popupMenu && "active")}>
                <div className={classNames("header__mobile", popupMenu && "active")}>
                    {isPWA() && <h4 className="header__mobile-title">Бренды</h4>}
                    <ul className="header__mobile-list mobile-nav">
                        {isPWA() ? (
                            brands.map(({id, brand}) => (
                                <li className="mobile-nav__el" onClick={() => onClickBrand(brand)} key={id}>
                                    <img src={images.filter(obj => obj.includes(brand))} alt={brand}/>
                                </li>
                            ))
                        ) : (
                            <>
                                <li className="mobile-nav__el" onClick={() => navigate(pageToLink) }>
                                    <svg
                                        fill="none"
                                        height="20" 
                                        onClick={() => navigate('/catalog/')} 
                                        viewBox="0 0 40 40" 
                                        width="20" 
                                    >
                                        <path d="M24.2852 22.4C26.5309 22.4 28.6051 21.568 30.2737 20.1696L37.5593 28.3296C37.8271 28.63 38.1906 28.799 38.5696 28.7993C38.7574 28.7994 38.9432 28.7582 39.1167 28.6779C39.2902 28.5976 39.4478 28.4798 39.5806 28.3312C39.7135 28.1827 39.8189 28.0063 39.8908 27.8121C39.9628 27.6179 39.9999 27.4098 40 27.1995C40.0001 26.9893 39.9633 26.7811 39.8916 26.5868C39.8199 26.3925 39.7147 26.216 39.5821 26.0672L32.2965 17.9072C33.6451 15.8873 34.3454 13.4167 34.2842 10.8954C34.223 8.37416 33.4037 5.94986 31.9591 4.01505C30.5144 2.08025 28.529 0.748222 26.3243 0.234653C24.1195 -0.278916 21.8246 0.0560409 19.811 1.18529C17.7974 2.31453 16.183 4.17196 15.2293 6.4568C14.2756 8.74165 14.0384 11.3201 14.5561 13.7748C15.0738 16.2294 16.3161 18.4165 18.0818 19.9819C19.8475 21.5473 22.0333 22.3993 24.2852 22.4ZM24.2852 19.2C22.3909 19.2 20.5741 18.3572 19.2346 16.8569C17.895 15.3566 17.1425 13.3217 17.1425 11.2C17.1425 9.07828 17.895 7.04345 19.2346 5.54316C20.5741 4.04287 22.3909 3.20001 24.2852 3.20001C26.1796 3.20001 27.9964 4.04287 29.3359 5.54316C30.6754 7.04345 31.4279 9.07828 31.4279 11.2C31.4279 13.3217 30.6754 15.3566 29.3359 16.8569C27.9964 18.3572 26.1796 19.2 24.2852 19.2ZM34.0993 28.9792L31.0822 25.6H2.14281C1.5745 25.6 1.02947 25.8529 0.627616 26.3029C0.22576 26.753 0 27.3635 0 28C0 28.6365 0.22576 29.247 0.627616 29.6971C1.02947 30.1471 1.5745 30.4 2.14281 30.4H32.1422C32.5561 30.4002 32.9612 30.2661 33.3085 30.0139C33.6558 29.7618 33.9305 29.4024 34.0993 28.9792ZM14.6997 20.8C13.5826 19.4007 12.7207 17.77 12.1626 16H2.14281C1.5745 16 1.02947 16.2529 0.627616 16.703C0.22576 17.153 0 17.7635 0 18.4C0 19.0365 0.22576 19.647 0.627616 20.0971C1.02947 20.5472 1.5745 20.8 2.14281 20.8H14.6997ZM12.1626 6.40001C11.6855 7.90401 11.4283 9.51681 11.4283 11.2H2.14281C1.5745 11.2 1.02947 10.9472 0.627616 10.4971C0.22576 10.047 0 9.43653 0 8.80001C0 8.16349 0.22576 7.55304 0.627616 7.10295C1.02947 6.65287 1.5745 6.40001 2.14281 6.40001H12.1626ZM2.14281 35.2C1.5745 35.2 1.02947 35.4529 0.627616 35.9029C0.22576 36.353 0 36.9635 0 37.6C0 38.2365 0.22576 38.847 0.627616 39.2971C1.02947 39.7471 1.5745 40 2.14281 40H32.1422C32.7105 40 33.2556 39.7471 33.6574 39.2971C34.0593 38.847 34.285 38.2365 34.285 37.6C34.285 36.9635 34.0593 36.353 33.6574 35.9029C33.2556 35.4529 32.7105 35.2 32.1422 35.2H2.14281Z" fill="#212121"/>
                                    </svg>
                                    <span>{pageToLinkName}</span>
                                </li>
                                <li className="mobile-nav__el">
                                    <svg
                                        fill="none"
                                        height="20" 
                                        viewBox="0 0 45 40" 
                                        width="25" 
                                    >
                                        <path d="M43.9113 8.19721C43.2131 6.59311 42.2063 5.13949 40.9474 3.91773C39.6875 2.69232 38.2021 1.7185 36.5719 1.04923C34.8815 0.352489 33.0684 -0.00414399 31.238 3.63284e-05C28.67 3.63284e-05 26.1645 0.697778 23.9871 2.01573C23.4662 2.33101 22.9714 2.6773 22.5026 3.05459C22.0338 2.6773 21.5389 2.33101 21.018 2.01573C18.8407 0.697778 16.3352 3.63284e-05 13.7672 3.63284e-05C11.918 3.63284e-05 10.1262 0.351491 8.43326 1.04923C6.79765 1.72113 5.32353 2.68763 4.05776 3.91773C2.79718 5.13811 1.79019 6.59207 1.09388 8.19721C0.369834 9.86662 0 11.6394 0 13.4639C0 15.185 0.354207 16.9784 1.05741 18.8029C1.64602 20.3276 2.48987 21.9091 3.56812 23.5062C5.27665 26.0335 7.62587 28.6695 10.5429 31.3415C15.3768 35.7709 20.1638 38.8306 20.3669 38.9547L21.6014 39.7403C22.1484 40.0866 22.8516 40.0866 23.3985 39.7403L24.633 38.9547C24.8362 38.8255 29.618 35.7709 34.4571 31.3415C37.3741 28.6695 39.7233 26.0335 41.4318 23.5062C42.5101 21.9091 43.3591 20.3276 43.9425 18.8029C44.6457 16.9784 44.9999 15.185 44.9999 13.4639C45.0052 11.6394 44.6353 9.86662 43.9113 8.19721Z" fill="#212121"/>
                                    </svg>
                                    <span>Избранное</span>
                                </li>
                                <li className="mobile-nav__el" onClick={onClickRegPopup}>
                                    <svg
                                        fill="none"
                                        height="20"
                                        viewBox="0 0 35 40" 
                                        width="15" 
                                    >
                                        <path d="M17.5 0C20.2848 0 22.9555 1.05357 24.9246 2.92893C26.8938 4.8043 28 7.34784 28 10C28 12.6522 26.8938 15.1957 24.9246 17.0711C22.9555 18.9464 20.2848 20 17.5 20C14.7152 20 12.0445 18.9464 10.0754 17.0711C8.10625 15.1957 7 12.6522 7 10C7 7.34784 8.10625 4.8043 10.0754 2.92893C12.0445 1.05357 14.7152 0 17.5 0ZM17.5 22C29.1025 22 35 22 35 35V40H0V35C0 22 5.8975 22 17.5 22Z" fill="#212121"/>
                                    </svg>
                                    <span>{isReg ? 'Профиль' : 'Войти'}</span>
                                </li>
                                <li className="mobile-nav__el">
                                    <svg
                                        fill="none"
                                        height="20" 
                                        viewBox="0 0 40 40" 
                                        width="20" 
                                    >
                                        <path d="M0 1.71429C0 1.25963 0.180624 0.823593 0.502137 0.502102C0.823651 0.180612 1.25972 0 1.71441 0H2.98992C5.1615 0 6.46445 1.46057 7.20736 2.81829C7.70339 3.72343 8.06228 4.77257 8.34344 5.72343C8.41949 5.71743 8.49574 5.71438 8.57203 5.71429H37.1409C39.0382 5.71429 40.4097 7.52914 39.8885 9.35543L35.7099 24.0046C35.3353 25.3185 34.5427 26.4746 33.4521 27.2978C32.3616 28.1211 31.0325 28.5666 29.6661 28.5669H16.0697C14.6924 28.5669 13.3533 28.1147 12.2581 27.2797C11.1628 26.4447 10.3722 25.2732 10.0076 23.9451L8.27029 17.6091L5.39009 7.89943L5.3878 7.88114C5.03121 6.58514 4.69747 5.37143 4.19915 4.46629C3.7214 3.58629 3.33738 3.42857 2.99221 3.42857H1.71441C1.25972 3.42857 0.823651 3.24796 0.502137 2.92647C0.180624 2.60498 0 2.16894 0 1.71429ZM14.8582 40C16.0707 40 17.2335 39.5184 18.0909 38.6611C18.9483 37.8038 19.4299 36.641 19.4299 35.4286C19.4299 34.2162 18.9483 33.0534 18.0909 32.1961C17.2335 31.3388 16.0707 30.8571 14.8582 30.8571C13.6457 30.8571 12.4828 31.3388 11.6255 32.1961C10.7681 33.0534 10.2864 34.2162 10.2864 35.4286C10.2864 36.641 10.7681 37.8038 11.6255 38.6611C12.4828 39.5184 13.6457 40 14.8582 40ZM30.8593 40C32.0718 40 33.2346 39.5184 34.092 38.6611C34.9494 37.8038 35.431 36.641 35.431 35.4286C35.431 34.2162 34.9494 33.0534 34.092 32.1961C33.2346 31.3388 32.0718 30.8571 30.8593 30.8571C29.6468 30.8571 28.484 31.3388 27.6266 32.1961C26.7692 33.0534 26.2875 34.2162 26.2875 35.4286C26.2875 36.641 26.7692 37.8038 27.6266 38.6611C28.484 39.5184 29.6468 40 30.8593 40Z" fill="#212121"/>
                                    </svg>
                                    <span>Корзина</span>
                                </li>
                            </>
                        )}
                    </ul>
                </div>
            </div>
        );
    }


    return (
        <header className={className}>
            <div className="header__left">
                <img className="header__left-logo" src={mainLogo} alt="logo" onClick={() => navigate('/')}/>
                <p className="header__left-gender">
                    <span className={classNames(isMale && "active")} onClick={() => onClickGender(true)}>Мужчинам</span>
                    <span>/</span>
                    <span className={classNames(!isMale && "active")} onClick={() => onClickGender(false)}>Женщинам</span>
                </p>
            </div>

            <div className={classNames("header__burger", popupMenu && "active")} onClick={changePopupMenu}>
                <span className="header__burger-span"></span>
            </div>

            <nav className="header__navigation">
                <ul className="header__navigation-list nav-list">
                    <li className="nav-list__el" onClick={() => navigate(pageToLink) }>{pageToLinkName}</li>
                    <li className="nav-list__el">Избранное</li>
                    <li className="nav-list__el" onClick={onClickReg}>{isReg ? 'Профиль' : 'Войти'}</li>
                    <li className="nav-list__el">
                        <svg width="19" height="20" fill="none">
                            <path fill="#000" d="M0 .857C0 .63.086.412.238.251A.793.793 0 0 1 .814 0h.605c1.03 0 1.649.73 2.001 1.41.236.452.406.976.54 1.452a1.3 1.3 0 0 1 .108-.005h13.558c.9 0 1.551.908 1.304 1.82l-1.983 7.325a3.152 3.152 0 0 1-1.071 1.647 2.885 2.885 0 0 1-1.797.634H7.626a2.89 2.89 0 0 1-1.809-.643 3.155 3.155 0 0 1-1.068-1.667l-.824-3.168L2.558 3.95l-.001-.01c-.17-.647-.328-1.254-.564-1.707-.227-.44-.41-.519-.573-.519H.814a.793.793 0 0 1-.576-.25A.88.88 0 0 1 0 .856ZM7.051 20c.576 0 1.128-.24 1.535-.67.406-.428.635-1.01.635-1.616a2.35 2.35 0 0 0-.635-1.616 2.115 2.115 0 0 0-1.535-.67c-.575 0-1.127.241-1.534.67a2.35 2.35 0 0 0-.635 1.616c0 .607.228 1.188.635 1.617.407.428.959.669 1.534.669Zm7.594 0c.575 0 1.127-.24 1.534-.67a2.35 2.35 0 0 0 .636-1.616 2.35 2.35 0 0 0-.636-1.616 2.116 2.116 0 0 0-1.534-.67c-.575 0-1.127.241-1.534.67a2.35 2.35 0 0 0-.636 1.616c0 .607.229 1.188.636 1.617.407.428.959.669 1.534.669Z"/>
                        </svg>
                        <span>Корзина</span>
                    </li>
                </ul>
            </nav>

            {popupMenuRender()}
        </header>
    );
}
